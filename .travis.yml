dist: trusty
language: java
services:
- postgresql
cache:
- directories:
  - "$HOME/.m2/repository"
  - "$HOME/.sonar/cache"
before_script:
- psql -c 'create database controle;' -U $SPRING_DATASOURCE_USERNAME
after_success:
- bash <(curl -s https://codecov.io/bash)
addons:
  sonarcloud:
    organization: emegson
    token:
      secure: YLHlye6hr8IILdV1mTNfF2amkJq4Hawj64HzI+yJJGRndX3sqIFAIY7yxnITB1kQuMeIw1Gc/7I/tcADuQik6j5Qx9+9IrykClnCYrJBOEKHxMb8/3eMHrMI520V4UXcX2r+UGY2Yd6kZcYKvTa7gya7iVQ2zRVXk/GJx6+gzVMivEYacwmFDJ6sq+lUZSi2sHwVskj/saXB+/rA7Gy6VVakQJXGa1RB5o2dxV6HOkMHGEZtPJc1Uw1M2vXypaXg4sdFr2hdusdIrouQ76U9FxQmlcDiE4dbT+GVIDM7hhMHGnm61CkKrIqqY95BQexpBMryCxdb76AuWzOX1vdkhbJvUDDJYO3RCsQwaVZavvOZ1sbVj8sDmFcwKEIKwyMCm/ry++TO4/VvdUdn+y1XKKSKKLgOSDFxm1nP60J2yFNdx6SJGarFMscE4fVuWvs1WrEQg5EHr9VlNj+6X9n4p3SYdY9/27ARHCm9L+K2lpXIN6UpqGpeFcQSKAqv6yGK1GyriNi4b1KNTCTGe3uaT13doULICzSxPWXTeR3DD1cavgbrw1Kqj6UmxiUqYxKYHP27cm3jVHogoPODsR1kJQQzjgs0E14valwBgtfmXNNgSh4KaLvZ6iCJo3TBM4jkWuy9RDUfabAAzSwfOpM5Sc0X+h+LU2hbZT0SBieZy9s=
jobs:
  include:
  - stage: unit tests
    script: mvn clean jacoco:prepare-agent install jacoco:report sonar:sonar -Dsonar.projectKey=emegson_financasapi
  - stage: deploy to staging
    script: skip
    deploy:
      provider: heroku
      app: filhoemer-stages-staging
      api_key: 
        secure: aeJKVVFE+M4CIhdAtjTQzctFPra0QX85ie3EJ4SkKLFbh8TJ+/YcrY4O4zE65CEcts1VFAAUWJElB52PsF+n7DjD+85mw7zfMRCgM0rlwsHQnF+hu2PxbQdAV+bA/WwCNW3jwzzJVQx6FrGHGWGTP8d1DJBqW9I2nSIbbOY5Zzl4wPOmW/gElAgyQMGU5UszSowr1Ztu9+gz1I71578iVPF6hNdU8SKolNC9cnibtvZgyLIWRxNe57ctoGCQSwIilfXFqurMKRtdHO8hyeL2cbJW+LnIIAz3DMYUedB7Zidt7Ct7cruQ26vI/hjx8nOlIP00w926zDsukR8Zo1KPZowyGziRgSoAQnig7Z2NVmlL25YNedlxmIFFpv/1uoxA75muewWNLZW5OY5fEeUc+rXUV4bq+9rB4LOCsHEk85+2JingvJWIjqLLC9b94q297RgU7RUTCreJXbvoSzGQfQ51DzbHfiQnpQp+uEQdiEq9OJkmIjMF7uxQEYc25qY1XOMn5RfVwM+DadZ/wcBqSq+fG8qTBypE5xCqseb4+RltVP7Bd47nV3jGVRAoEhP13yuL3hLJ76dc+PlAxH+lXnrLhxDDCKIZ+h++JNq1xpOZijkaKSjunr1wEWAN+aznhc2oMSSnRvj77h1eJ2MA+HjJFaz4aECZIbqBdsNmedo=
  - stage: test staging
    script: curl https://filhoemer-staging.herokuapp.com
  - stage: deploy to production
    script: skip
    deploy:
      provider: heroku
      app: sf-stages-production
      api_key:
        secure: aeJKVVFE+M4CIhdAtjTQzctFPra0QX85ie3EJ4SkKLFbh8TJ+/YcrY4O4zE65CEcts1VFAAUWJElB52PsF+n7DjD+85mw7zfMRCgM0rlwsHQnF+hu2PxbQdAV+bA/WwCNW3jwzzJVQx6FrGHGWGTP8d1DJBqW9I2nSIbbOY5Zzl4wPOmW/gElAgyQMGU5UszSowr1Ztu9+gz1I71578iVPF6hNdU8SKolNC9cnibtvZgyLIWRxNe57ctoGCQSwIilfXFqurMKRtdHO8hyeL2cbJW+LnIIAz3DMYUedB7Zidt7Ct7cruQ26vI/hjx8nOlIP00w926zDsukR8Zo1KPZowyGziRgSoAQnig7Z2NVmlL25YNedlxmIFFpv/1uoxA75muewWNLZW5OY5fEeUc+rXUV4bq+9rB4LOCsHEk85+2JingvJWIjqLLC9b94q297RgU7RUTCreJXbvoSzGQfQ51DzbHfiQnpQp+uEQdiEq9OJkmIjMF7uxQEYc25qY1XOMn5RfVwM+DadZ/wcBqSq+fG8qTBypE5xCqseb4+RltVP7Bd47nV3jGVRAoEhP13yuL3hLJ76dc+PlAxH+lXnrLhxDDCKIZ+h++JNq1xpOZijkaKSjunr1wEWAN+aznhc2oMSSnRvj77h1eJ2MA+HjJFaz4aECZIbqBdsNmedo=
  - stage: test production
    script: curl https://filhoemer-production.herokuapp.com/